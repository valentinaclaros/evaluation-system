<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrar Feedback - Sistema de Evaluaci贸n</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h1> Sistema de Evaluaci贸n</h1>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">Dashboard</a></li>
                <li><a href="detalle-auditorias.html">Detalle de Auditor铆as</a></li>
                <li><a href="detalle-feedbacks.html">Detalle de Feedbacks</a></li>
                <li><a href="analisis-avanzado.html">An谩lisis Avanzado</a></li>
                <li><a href="agentes.html">Gesti贸n de Agentes</a></li>
                <li><a href="sj-pendientes.html">SJ Pendientes</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <header class="page-header">
            <h2>Registrar Nuevo Feedback</h2>
            <a href="index.html" class="btn btn-secondary">Volver al Dashboard</a>
        </header>

        <div class="form-card">
            <form id="feedbackForm" class="audit-form">
                <!-- Informaci贸n del Agente -->
                <div class="form-section">
                    <h3 class="section-title">Informaci贸n del Agente</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="feedbackAgentId">Nombre del Agente *</label>
                            <select id="feedbackAgentId" name="feedbackAgentId" required>
                                <option value="">Seleccionar agente...</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="feedbackGivenBy">Feedback Dado Por *</label>
                            <input type="text" id="feedbackGivenBy" name="feedbackGivenBy" value="Daniel Rodr铆guez" readonly required>
                        </div>

                        <div class="form-group">
                            <label for="feedbackDate">Fecha del Feedback *</label>
                            <input type="date" id="feedbackDate" name="feedbackDate" required>
                        </div>
                    </div>
                </div>

                <!-- Detalles del Feedback -->
                <div class="form-section">
                    <h3 class="section-title">Detalles del Feedback</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="feedbackType">Tipo de Feedback *</label>
                            <select id="feedbackType" name="feedbackType" required>
                                <option value="">Seleccionar tipo...</option>
                                <option value="Disciplinario">Disciplinario</option>
                                <option value="Comportamiento">Comportamiento</option>
                                <option value="Desempe帽o">Desempe帽o</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="channel">Canal de Interacci贸n *</label>
                            <select id="channel" name="channel" required>
                                <option value="">Seleccionar canal...</option>
                                <option value="phone">Phone</option>
                                <option value="chat">Chat</option>
                                <option value="email">Email</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="owner">Owner *</label>
                        <select id="owner" name="owner" required>
                            <option value="">Seleccionar owner...</option>
                            <option value="Andersson Franco">Andersson Franco</option>
                            <option value="Sebasti谩n Aranguren">Sebasti谩n Aranguren</option>
                            <option value="Kimberly Tovar">Kimberly Tovar</option>
                            <option value="Yesica Cifuentes">Yesica Cifuentes</option>
                            <option value="Alisson Ca帽izares">Alisson Ca帽izares</option>
                            <option value="Derly O帽ate">Derly O帽ate</option>
                            <option value="Fabian Zipamocha">Fabian Zipamocha</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <label for="planAccion">Plan de Acci贸n *</label>
                        <textarea id="planAccion" name="planAccion" rows="4" 
                                  placeholder="Describe el plan de acci贸n..." required></textarea>
                    </div>
                </div>

                <!-- Auditor铆as Relacionadas -->
                <div class="form-section">
                    <h3 class="section-title">Auditor铆as Relacionadas</h3>
                    <p class="section-description">Selecciona las auditor铆as relacionadas</p>
                    
                    <div id="relatedCallsCheckboxes" class="checkbox-group">
                        <p class="info-text">Primero selecciona un agente para ver sus auditor铆as...</p>
                    </div>
                </div>

                <!-- Matriz Disciplinaria -->
                <div class="form-section">
                    <h3 class="section-title">Matriz Disciplinaria</h3>
                    
                    <div class="form-group">
                        <label for="matrizDisciplinaria">驴Aplica Matriz Disciplinaria? *</label>
                        <select id="matrizDisciplinaria" name="matrizDisciplinaria" required>
                            <option value="">Seleccionar...</option>
                            <option value="Si">S铆</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                </div>

                <!-- SECCIN STRIKE: Selecci贸n Manual de Strike (solo si aplica matriz) -->
                <div class="form-section" id="strikeSection" style="display: none;">
                    <h3 class="section-title">锔 Strike por Reincidencia</h3>
                    <div class="form-group">
                        <label for="strikeLevel">Nivel de Strike *</label>
                        <select id="strikeLevel" name="strikeLevel">
                            <option value="">Seleccionar strike...</option>
                            <option value="1">锔 Strike 1 (Primera/Segunda reincidencia)</option>
                            <option value="2"> Strike 2 (Tercera reincidencia)</option>
                            <option value="3"> Strike 3 (Cuarta reincidencia)</option>
                        </select>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem;">
                         <strong>Nota:</strong> Selecciona el nivel de strike seg煤n el historial de reincidencias del agente.
                    </p>
                </div>

                <!-- Detalles de la Matriz Disciplinaria (se muestra solo si aplica) -->
                <div class="form-section" id="matrizDetallesSection" style="display: none;">
                    <h3 class="section-title">Detalles de la Matriz Disciplinaria</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tipoFalta">Tipo de Falta *</label>
                            <select id="tipoFalta" name="tipoFalta">
                                <option value="">Seleccionar tipo...</option>
                                <option value="Disciplinaria">Disciplinaria</option>
                                <option value="Desempe帽o">Desempe帽o</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="gravedad">Gravedad *</label>
                            <select id="gravedad" name="gravedad">
                                <option value="">Seleccionar gravedad...</option>
                                <option value="Baja">Baja</option>
                                <option value="Media">Media</option>
                                <option value="Alta">Alta</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label for="descripcionFalta">Descripci贸n de la Falta *</label>
                        <textarea id="descripcionFalta" name="descripcionFalta" rows="3" 
                                  placeholder="Describe la falta..."></textarea>
                    </div>

                    <!-- Incidencias -->
                    <div id="incidenciasContainer" style="display: none;">
                        <h4 class="subsection-title" id="incidenciaTitle">Incidencias</h4>
                        
                        <!-- Primera Incidencia -->
                        <div class="form-group" id="primeraIncidencia" style="display: none;">
                            <label for="accionPrimeraIncidencia">Primera Incidencia - Tipo de Acci贸n *</label>
                            <select id="accionPrimeraIncidencia" name="accionPrimeraIncidencia">
                                <option value="">Seleccionar acci贸n...</option>
                                <option value="Advertencia escrita">Advertencia escrita</option>
                                <option value="Llamado de atenci贸n">Llamado de atenci贸n</option>
                                <option value="Suspensi贸n">Suspensi贸n</option>
                                <option value="Terminaci贸n">Terminaci贸n</option>
                            </select>
                        </div>

                        <!-- Segunda Incidencia -->
                        <div class="form-group" id="segundaIncidencia" style="display: none;">
                            <label for="accionSegundaIncidencia">Segunda Incidencia - Tipo de Acci贸n *</label>
                            <select id="accionSegundaIncidencia" name="accionSegundaIncidencia">
                                <option value="">Seleccionar acci贸n...</option>
                                <option value="Advertencia escrita">Advertencia escrita</option>
                                <option value="Llamado de atenci贸n">Llamado de atenci贸n</option>
                                <option value="Suspensi贸n">Suspensi贸n</option>
                                <option value="Terminaci贸n">Terminaci贸n</option>
                            </select>
                        </div>

                        <!-- Tercera Incidencia -->
                        <div class="form-group" id="terceraIncidencia" style="display: none;">
                            <label for="accionTerceraIncidencia">Tercera Incidencia - Tipo de Acci贸n *</label>
                            <select id="accionTerceraIncidencia" name="accionTerceraIncidencia">
                                <option value="">Seleccionar acci贸n...</option>
                                <option value="Advertencia escrita">Advertencia escrita</option>
                                <option value="Llamado de atenci贸n">Llamado de atenci贸n</option>
                                <option value="Suspensi贸n">Suspensi贸n</option>
                                <option value="Terminaci贸n">Terminaci贸n</option>
                            </select>
                        </div>

                        <!-- Cuarta Incidencia -->
                        <div class="form-group" id="cuartaIncidencia" style="display: none;">
                            <label for="accionCuartaIncidencia">Cuarta Incidencia - Tipo de Acci贸n *</label>
                            <select id="accionCuartaIncidencia" name="accionCuartaIncidencia">
                                <option value="">Seleccionar acci贸n...</option>
                                <option value="Advertencia escrita">Advertencia escrita</option>
                                <option value="Llamado de atenci贸n">Llamado de atenci贸n</option>
                                <option value="Suspensi贸n">Suspensi贸n</option>
                                <option value="Terminaci贸n">Terminaci贸n</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" onclick="window.location.href='index.html'" class="btn btn-secondary">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Feedback</button>
                </div>
            </form>
        </div>

        <!-- Mensaje de 茅xito -->
        <div id="successMessage" class="alert alert-success" style="display: none;">
            <strong>隆xito!</strong> El feedback ha sido registrado correctamente.
        </div>

        <!-- Mensaje de error -->
        <div id="errorMessage" class="alert alert-error" style="display: none;">
            <strong>Error:</strong> <span id="errorText"></span>
        </div>
    </main>

    <!-- Supabase SDK v2 -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    <script src="supabase-config.js"></script>
    <script src="app.js"></script>
    <script src="registrar-feedback.js"></script>
</body>
</html>

