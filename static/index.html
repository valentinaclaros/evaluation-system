<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Evaluación del Desempeño</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                <h2>Performance</h2>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-section="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-section="agents">
                    <i class="fas fa-users"></i>
                    <span>Agentes</span>
                </a>
                <a href="#" class="nav-item" data-section="audits">
                    <i class="fas fa-clipboard-check"></i>
                    <span>Auditorías</span>
                </a>
                <a href="#" class="nav-item" data-section="feedbacks">
                    <i class="fas fa-comments"></i>
                    <span>Feedbacks</span>
                </a>
                <a href="#" class="nav-item" data-section="analytics">
                    <i class="fas fa-chart-bar"></i>
                    <span>Análisis</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section active">
                <div class="section-header">
                    <h1>Dashboard de Desempeño</h1>
                    <p>Vista general del sistema de evaluación</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-agents">0</h3>
                            <p>Agentes Activos</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon purple">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-audits">0</h3>
                            <p>Auditorías Realizadas</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon orange">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-feedbacks">0</h3>
                            <p>Feedbacks Entregados</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon red">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="critical-errors">0</h3>
                            <p>Errores Críticos</p>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>Tasa de Errores Promedio</h3>
                        </div>
                        <div class="card-body">
                            <div class="metric-display">
                                <span class="metric-value" id="avg-error-rate">0%</span>
                                <span class="metric-label">de las llamadas tienen errores</span>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>TNPS General</h3>
                        </div>
                        <div class="card-body">
                            <div class="tnps-stats">
                                <div class="tnps-item">
                                    <span class="tnps-label promoter">Promotores</span>
                                    <span class="tnps-value" id="promoter-pct">0%</span>
                                </div>
                                <div class="tnps-item">
                                    <span class="tnps-label detractor">Detractores</span>
                                    <span class="tnps-value" id="detractor-pct">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Top 10 Agentes por Menor Tasa de Error</h3>
                    </div>
                    <div class="card-body">
                        <div id="agents-ranking-table"></div>
                    </div>
                </div>
            </section>

            <!-- Agents Section -->
            <section id="agents" class="content-section">
                <div class="section-header">
                    <h1>Gestión de Agentes</h1>
                    <button class="btn btn-primary" onclick="showAgentForm()">
                        <i class="fas fa-plus"></i> Nuevo Agente
                    </button>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div id="agents-table"></div>
                    </div>
                </div>

                <!-- Agent Form Modal -->
                <div id="agent-modal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>Nuevo Agente</h2>
                            <button class="close-btn" onclick="closeModal('agent-modal')">&times;</button>
                        </div>
                        <form id="agent-form">
                            <div class="form-group">
                                <label>Nombre Completo *</label>
                                <input type="text" name="name" required>
                            </div>
                            <div class="form-group">
                                <label>Email *</label>
                                <input type="email" name="email" required>
                            </div>
                            <div class="form-group">
                                <label>Departamento</label>
                                <input type="text" name="department">
                            </div>
                            <div class="form-group">
                                <label>Cargo</label>
                                <input type="text" name="position">
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="closeModal('agent-modal')">Cancelar</button>
                                <button type="submit" class="btn btn-primary">Guardar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Audits Section -->
            <section id="audits" class="content-section">
                <div class="section-header">
                    <h1>Auditorías de Llamadas</h1>
                    <button class="btn btn-primary" onclick="showAuditForm()">
                        <i class="fas fa-plus"></i> Nueva Auditoría
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Filtros</h3>
                    </div>
                    <div class="card-body">
                        <div class="filter-grid">
                            <div class="form-group">
                                <label>Agente</label>
                                <select id="filter-agent">
                                    <option value="">Todos</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Fecha Inicio</label>
                                <input type="date" id="filter-start-date">
                            </div>
                            <div class="form-group">
                                <label>Fecha Fin</label>
                                <input type="date" id="filter-end-date">
                            </div>
                            <div class="form-group">
                                <label>Criticidad</label>
                                <select id="filter-criticality">
                                    <option value="">Todas</option>
                                    <option value="baja">Baja</option>
                                    <option value="media">Media</option>
                                    <option value="alta">Alta</option>
                                    <option value="crítica">Crítica</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="applyAuditFilters()">Aplicar Filtros</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div id="audits-table"></div>
                    </div>
                </div>

                <!-- Audit Form Modal -->
                <div id="audit-modal" class="modal">
                    <div class="modal-content large">
                        <div class="modal-header">
                            <h2>Nueva Auditoría de Llamada</h2>
                            <button class="close-btn" onclick="closeModal('audit-modal')">&times;</button>
                        </div>
                        <form id="audit-form">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Fecha de la Llamada *</label>
                                    <input type="datetime-local" name="call_date" required>
                                </div>
                                <div class="form-group">
                                    <label>Customer ID *</label>
                                    <input type="text" name="customer_id" required>
                                </div>
                                <div class="form-group">
                                    <label>Tipo de Llamada *</label>
                                    <select name="call_type" required>
                                        <option value="">Seleccionar...</option>
                                        <option value="tarjeta_credito">Tarjeta de Crédito</option>
                                        <option value="cuenta_ahorros">Cuenta de Ahorros</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Agente *</label>
                                    <select name="agent_id" id="audit-agent-select" required>
                                        <option value="">Seleccionar...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Auditor *</label>
                                    <select name="auditor_id" id="audit-auditor-select" required>
                                        <option value="">Seleccionar...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Nivel de Criticidad *</label>
                                    <select name="criticality_level" required>
                                        <option value="">Seleccionar...</option>
                                        <option value="baja">Baja</option>
                                        <option value="media">Media</option>
                                        <option value="alta">Alta</option>
                                        <option value="crítica">Crítica</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Tipo de Error</label>
                                <input type="text" name="error_type" placeholder="Ej: Falta de verificación de identidad">
                            </div>
                            <div class="form-group">
                                <label>Descripción del Error</label>
                                <textarea name="error_description" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Calificación TNPS</label>
                                <select name="tnps_score">
                                    <option value="null">No respondió</option>
                                    <option value="promoter">Promotor</option>
                                    <option value="neutral">Neutral</option>
                                    <option value="detractor">Detractor</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Notas Adicionales</label>
                                <textarea name="notes" rows="3"></textarea>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="closeModal('audit-modal')">Cancelar</button>
                                <button type="submit" class="btn btn-primary">Guardar Auditoría</button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Feedbacks Section -->
            <section id="feedbacks" class="content-section">
                <div class="section-header">
                    <h1>Gestión de Feedbacks</h1>
                    <button class="btn btn-primary" onclick="showFeedbackForm()">
                        <i class="fas fa-plus"></i> Nuevo Feedback
                    </button>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div id="feedbacks-table"></div>
                    </div>
                </div>

                <!-- Feedback Form Modal -->
                <div id="feedback-modal" class="modal">
                    <div class="modal-content large">
                        <div class="modal-header">
                            <h2>Nuevo Feedback</h2>
                            <button class="close-btn" onclick="closeModal('feedback-modal')">&times;</button>
                        </div>
                        <form id="feedback-form">
                            <div class="form-group">
                                <label>Agente *</label>
                                <select name="agent_id" id="feedback-agent-select" required>
                                    <option value="">Seleccionar...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Fecha del Feedback *</label>
                                <input type="datetime-local" name="feedback_date" required>
                            </div>
                            <div class="form-group">
                                <label>Título *</label>
                                <input type="text" name="title" required placeholder="Ej: Mejora en verificación de identidad">
                            </div>
                            <div class="form-group">
                                <label>Descripción *</label>
                                <textarea name="description" rows="4" required placeholder="Detalla el feedback proporcionado al agente..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Plan de Acción</label>
                                <textarea name="action_plan" rows="4" placeholder="Acciones específicas que debe tomar el agente..."></textarea>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="closeModal('feedback-modal')">Cancelar</button>
                                <button type="submit" class="btn btn-primary">Guardar Feedback</button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="analytics" class="content-section">
                <div class="section-header">
                    <h1>Análisis de Desempeño</h1>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Seleccionar Agente</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <select id="analytics-agent-select" onchange="loadAgentAnalytics()">
                                <option value="">Seleccionar agente...</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="analytics-content" style="display: none;">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon blue">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="agent-total-calls">0</h3>
                                <p>Total de Llamadas</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon red">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="agent-total-errors">0</h3>
                                <p>Total de Errores</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon orange">
                                <i class="fas fa-percent"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="agent-error-rate">0%</h3>
                                <p>Tasa de Error</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon purple">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="agent-tnps">0</h3>
                                <p>TNPS Score</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Distribución TNPS</h3>
                        </div>
                        <div class="card-body">
                            <div class="tnps-distribution">
                                <div class="tnps-bar">
                                    <div class="tnps-segment promoter" id="promoter-bar" style="width: 0%"></div>
                                    <div class="tnps-segment neutral" id="neutral-bar" style="width: 0%"></div>
                                    <div class="tnps-segment detractor" id="detractor-bar" style="width: 0%"></div>
                                    <div class="tnps-segment null" id="null-bar" style="width: 0%"></div>
                                </div>
                                <div class="tnps-legend">
                                    <div class="legend-item">
                                        <span class="legend-color promoter"></span>
                                        <span id="promoter-legend">Promotores: 0</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color neutral"></span>
                                        <span id="neutral-legend">Neutrales: 0</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color detractor"></span>
                                        <span id="detractor-legend">Detractores: 0</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color null"></span>
                                        <span id="null-legend">Sin respuesta: 0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Distribución de Errores por Tipo</h3>
                        </div>
                        <div class="card-body">
                            <div id="error-distribution"></div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Feedbacks y Análisis de Mejora</h3>
                        </div>
                        <div class="card-body">
                            <div id="agent-feedbacks"></div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>

