<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrar Auditor√≠a - Sistema de Evaluaci√≥n</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h1>üìä Sistema de Evaluaci√≥n</h1>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">Dashboard</a></li>
                <li><a href="detalle-auditorias.html">Detalle de Auditor√≠as</a></li>
                <li><a href="detalle-feedbacks.html">Detalle de Feedbacks</a></li>
                <li><a href="analisis-avanzado.html">An√°lisis Avanzado</a></li>
                <li><a href="agentes.html">Gesti√≥n de Agentes</a></li>
                <li><a href="sj-pendientes.html">SJ Pendientes</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <header class="page-header">
            <h2>Registrar Nueva Auditor√≠a de Llamada</h2>
            <p class="subtitle">Completa la informaci√≥n de la llamada auditada</p>
        </header>

        <div class="form-card">
            <form id="auditForm" class="audit-form">
                <div class="form-section">
                    <h3 class="section-title">Informaci√≥n General</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="callDate">Fecha de la Llamada *</label>
                            <input type="date" id="callDate" name="callDate" required>
                        </div>

                        <div class="form-group">
                            <label for="customerId">Customer ID *</label>
                            <input type="text" id="customerId" name="customerId" placeholder="Ej: CUST-12345" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="callType">Raz√≥n de Contacto *</label>
                            <select id="callType" name="callType" onchange="updateCancellationReasons()" required>
                                <option value="">Selecciona una raz√≥n</option>
                                <option value="cancelacion_cuenta_ahorros">Cancelaci√≥n Cuenta de Ahorros</option>
                                <option value="cancelacion_tarjeta_credito">Cancelaci√≥n Tarjeta de Cr√©dito</option>
                                <option value="cancelacion_multiproducto">Cancelaci√≥n Multiproducto</option>
                            </select>
                        </div>

                        <div class="form-group" id="cancellationReasonGroup" style="display: none;">
                            <label for="cancellationReason">Motivo *</label>
                            <select id="cancellationReason" name="cancellationReason">
                                <option value="">Selecciona un motivo</option>
                            </select>
                        </div>

                        <!-- Campos espec√≠ficos para Multiproducto -->
                        <div class="form-group" id="multiproductoAhorrosReasonGroup" style="display: none;">
                            <label for="multiproductoAhorrosReason">Motivo Cuenta de Ahorros *</label>
                            <select id="multiproductoAhorrosReason" name="multiproductoAhorrosReason">
                                <option value="">Selecciona un motivo</option>
                            </select>
                        </div>

                        <div class="form-group" id="multiproductoCreditoReasonGroup" style="display: none;">
                            <label for="multiproductoCreditoReason">Motivo Tarjeta de Cr√©dito *</label>
                            <select id="multiproductoCreditoReason" name="multiproductoCreditoReason">
                                <option value="">Selecciona un motivo</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="auditDate">Fecha de Auditor√≠a *</label>
                            <input type="date" id="auditDate" name="auditDate" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="enlacePv">Enlace PV *</label>
                            <input type="url" id="enlacePv" name="enlacePv" placeholder="https://..." required>
                            <small class="form-hint">URL del enlace PV de la llamada</small>
                        </div>

                        <div class="form-group">
                            <label for="bpo">BPO *</label>
                            <select id="bpo" name="bpo" required>
                                <option value="">Selecciona BPO</option>
                                <option value="teleperformance">Teleperformance</option>
                                <option value="konecta">Konecta</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">Personal Involucrado</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="agentId">Agente que Atendi√≥ *</label>
                            <select id="agentId" name="agentId" required>
                                <option value="">Selecciona un agente</option>
                            </select>
                            <small class="form-hint">Si no encuentras el agente, agr√©galo en <a href="agentes.html">Gesti√≥n de Agentes</a></small>
                        </div>

                        <div class="form-group">
                            <label for="auditor">Auditor *</label>
                            <select id="auditor" name="auditor" required>
                                <option value="">Selecciona un auditor</option>
                                <option value="Andr√©s Gay√≥n">Andr√©s Gay√≥n</option>
                                <option value="Daniel Aristizabal">Daniel Aristizabal</option>
                                <option value="Daniel Rodr√≠guez">Daniel Rodr√≠guez</option>
                                <option value="Nicol√°s Gonz√°lez">Nicol√°s Gonz√°lez</option>
                                <option value="Paula Morales">Paula Morales</option>
                                <option value="Valentina Claros">Valentina Claros</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">Evaluaci√≥n de la Llamada</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="criticality">Nivel de Criticidad *</label>
                            <select id="criticality" name="criticality" required>
                                <option value="">Selecciona nivel</option>
                                <option value="critico">üî¥ Cr√≠tico</option>
                                <option value="alto">üü† Alto</option>
                                <option value="medio">üü° Medio</option>
                                <option value="perfecto">üü¢ Perfecto</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="tnps">Calificaci√≥n TNPS *</label>
                            <select id="tnps" name="tnps" required>
                                <option value="">Selecciona calificaci√≥n</option>
                                <option value="promoter">üü¢ Promoter (9-10)</option>
                                <option value="neutral">üü° Neutral (7-8)</option>
                                <option value="detractor">üî¥ Detractor (0-6)</option>
                                <option value="null">‚ö™ Sin respuesta</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label>Errores del Agente *</label>
                        <p class="form-hint" id="errorHint">Primero selecciona un motivo de cancelaci√≥n para ver las opciones de errores</p>
                        
                        <!-- Contenedor de errores que cambia din√°micamente -->
                        <div id="errorsContainer" style="display: none;">
                            
                            <!-- Errores para Cuenta de Ahorros -->
                            <div id="errorsCuentaAhorros" class="errors-section" style="display: none;">
                                <h4 class="errors-section-title">Cuenta de Ahorros</h4>
                                <div class="checkbox-errors-group">
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="No se validaron Tags"> No se validaron Tags</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="No se revis√≥ el estado del producto en la herramienta"> No se revis√≥ el estado del producto en la herramienta</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="No se realiz√≥ HF"> No se realiz√≥ HF</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="No se indag√≥ en el motivo de cancelaci√≥n"> No se indag√≥ en el motivo de cancelaci√≥n</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="No se leyeron beneficios"> No se leyeron beneficios</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="No se valid√≥ si el cliente tiene CDT activo"> No se valid√≥ si el cliente tiene CDT activo</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="No se hizo retenci√≥n"> No se hizo retenci√≥n</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="No se valid√≥ el producto (saldo en cajita, saldos mayores a $0,99, pr√©stamo activo, etc.)"> No se valid√≥ el producto (saldo en cajita, saldos mayores a $0,99, pr√©stamo activo, etc.)</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="No se solicit√≥ aproximaci√≥n de saldo"> No se solicit√≥ aproximaci√≥n de saldo</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="No se leyeron condiciones de cancelaci√≥n"> No se leyeron condiciones de cancelaci√≥n</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="No se cancelaron las tarjetas (f√≠sicas/virtuales)"> No se cancelaron las tarjetas (f√≠sicas/virtuales)</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="No se escal√≥ Secundary Job"> No se escal√≥ Secundary Job</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="No se confirm√≥ la gesti√≥n realizada"> No se confirm√≥ la gesti√≥n realizada</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="Se dan tiempos de cancelaci√≥n incorrectos"> Se dan tiempos de cancelaci√≥n incorrectos</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="No se promueve case management"> No se promueve case management</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="No se promueve encuesta"> No se promueve encuesta</label>
                                </div>
                            </div>
                            
                            <!-- Errores para Tarjeta de Cr√©dito -->
                            <div id="errorsTarjetaCredito" class="errors-section" style="display: none;">
                                <h4 class="errors-section-title">Tarjeta de Cr√©dito</h4>
                                <div class="checkbox-errors-group">
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="TC: No se validaron Tags"> No se validaron Tags</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="TC: No se revis√≥ el estado del producto en la herramienta"> No se revis√≥ el estado del producto en la herramienta</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="TC: No se realiz√≥ HF"> No se realiz√≥ HF</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="TC: No se indag√≥ en el motivo de cancelaci√≥n"> No se indag√≥ en el motivo de cancelaci√≥n</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="TC: No se leyeron beneficios"> No se leyeron beneficios</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="TC: No se valid√≥ el tipo de tarjeta de cr√©dito que ten√≠a el cliente"> No se valid√≥ el tipo de tarjeta de cr√©dito que ten√≠a el cliente</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="TC: No se hizo retenci√≥n"> No se hizo retenci√≥n</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="TC: No se valid√≥ el producto (deuda activa, saldo a favor, compras en proceso, complaints activos, etc.)"> No se valid√≥ el producto (deuda activa, saldo a favor, compras en proceso, complaints activos, etc.)</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="TC: No se leyeron condiciones de cancelaci√≥n"> No se leyeron condiciones de cancelaci√≥n</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="TC: No se cancelaron las tarjetas (f√≠sicas/virtuales)"> No se cancelaron las tarjetas (f√≠sicas/virtuales)</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="TC: No se escal√≥ Secundary Job"> No se escal√≥ Secundary Job</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="TC: No se confirm√≥ la gesti√≥n realizada"> No se confirm√≥ la gesti√≥n realizada</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="TC: Se dan tiempos de cancelaci√≥n incorrectos"> Se dan tiempos de cancelaci√≥n incorrectos</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="TC: No se promueve case management"> No se promueve case management</label>
                                    <label class="checkbox-error-item"><input type="checkbox" name="error" value="TC: No se promueve encuesta"> No se promueve encuesta</label>
                                </div>
                            </div>
                            
                        </div>
                    </div>

                    <!-- Nueva Secci√≥n: M√©tricas Operativas -->
                    <div class="form-section">
                        <h3 class="section-title">M√©tricas Operativas</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="callDuration">Duraci√≥n de la Llamada (MM:SS) *</label>
                                <input type="text" id="callDuration" name="callDuration" placeholder="Ej: 5:30" pattern="[0-9]{1,3}:[0-5][0-9]" required>
                                <small style="color: var(--text-secondary); font-size: 0.85rem;">Formato: Minutos:Segundos (ejemplo: 1:45 = 1 minuto y 45 segundos)</small>
                            </div>

                            <div class="form-group">
                                <label for="transferAttempt">¬øEl agente intent√≥ transferir la llamada?</label>
                                <select id="transferAttempt" name="transferAttempt" required>
                                    <option value="">Selecciona una opci√≥n</option>
                                    <option value="no">No</option>
                                    <option value="si">S√≠</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="excessiveHold">¬øHubo tiempos de espera > 2 minutos?</label>
                                <select id="excessiveHold" name="excessiveHold" onchange="toggleHoldTimeInput()" required>
                                    <option value="">Selecciona una opci√≥n</option>
                                    <option value="no">No</option>
                                    <option value="si">S√≠</option>
                                </select>
                            </div>

                            <div class="form-group" id="holdTimeGroup" style="display: none;">
                                <label for="holdTime">Especifica el tiempo de espera (MM:SS)</label>
                                <input type="text" id="holdTime" name="holdTime" placeholder="Ej: 3:30" pattern="[0-9]{1,3}:[0-5][0-9]">
                                <small style="color: var(--text-secondary); font-size: 0.85rem;">Formato: Minutos:Segundos (ejemplo: 2:15 = 2 minutos y 15 segundos)</small>
                            </div>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label for="callNotes">Notas Adicionales</label>
                        <textarea id="callNotes" name="callNotes" rows="3" 
                                  placeholder="Informaci√≥n adicional sobre la llamada (opcional)"></textarea>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" onclick="window.location.href='index.html'" class="btn btn-secondary">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Auditor√≠a</button>
                </div>
            </form>
        </div>

        <!-- Mensaje de √©xito -->
        <div id="successMessage" class="alert alert-success" style="display: none;">
            <strong>¬°√âxito!</strong> La auditor√≠a ha sido registrada correctamente.
        </div>

        <!-- Mensaje de error -->
        <div id="errorMessage" class="alert alert-error" style="display: none;">
            <strong>Error:</strong> <span id="errorText"></span>
        </div>
    </main>

    <!-- Supabase SDK v2 -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    <script src="supabase-config.js"></script>
    <script src="app.js"></script>
    <script src="registrar-llamada.js"></script>
</body>
</html>

