<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Evaluaci√≥n del Desempe√±o - Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h1>üìä Sistema de Evaluaci√≥n</h1>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html" class="active">Dashboard</a></li>
                <li><a href="detalle-auditorias.html">Detalle de Auditor√≠as</a></li>
                <li><a href="importar-auditorias.html">Importar Auditor√≠as</a></li>
                <li><a href="detalle-feedbacks.html">Detalle de Feedbacks</a></li>
                <li><a href="analisis-avanzado.html">An√°lisis Avanzado</a></li>
                <li><a href="agentes.html">Gesti√≥n de Agentes</a></li>
                <li><a href="sj-pendientes.html">SJ Pendientes</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <header class="page-header">
            <h2>Dashboard de Desempe√±o</h2>
            <div class="date-filter">
                <label for="dateFrom">Desde:</label>
                <input type="date" id="dateFrom">
                <label for="dateTo">Hasta:</label>
                <input type="date" id="dateTo">
                <label for="filterAgent">Agente:</label>
                <select id="filterAgent">
                    <option value="">Todos</option>
                </select>
                <button onclick="filterByDate()" class="btn btn-primary">Filtrar</button>
            </div>
        </header>

        <!-- Tarjetas de m√©tricas principales -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-icon" style="background: #e3f2fd;">üìû</div>
                <div class="metric-info">
                    <h3>Total Llamadas Auditadas</h3>
                    <p class="metric-value" id="totalCalls">0</p>
                    <span class="metric-subtitle">En el per√≠odo seleccionado</span>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-icon" style="background: #fee2e2;">‚ö†Ô∏è</div>
                <div class="metric-info">
                    <h3>Errores Cr√≠ticos y Altos</h3>
                    <p class="metric-value" id="criticalErrors">0</p>
                    <span class="metric-subtitle">Requieren atenci√≥n prioritaria</span>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-icon" style="background: #e8f5e9;">üí¨</div>
                <div class="metric-info">
                    <h3>Feedbacks Entregados</h3>
                    <p class="metric-value" id="totalFeedbacks">0</p>
                    <span class="metric-subtitle">A agentes</span>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-icon" style="background: #f3e5f5;">‚≠ê</div>
                <div class="metric-info">
                    <h3>Agentes Activos</h3>
                    <p class="metric-value" id="activeAgents">0</p>
                    <span class="metric-subtitle">Registrados en el sistema</span>
                </div>
            </div>
        </div>

        <!-- Distribuci√≥n TNPS -->
        <div class="section-grid">
            <div class="card">
                <div class="card-header">
                    <h3>Distribuci√≥n TNPS</h3>
                </div>
                <div class="card-body">
                    <div class="tnps-container">
                        <div class="tnps-item promoter">
                            <div class="tnps-bar">
                                <div class="tnps-fill" id="promoterBar" style="width: 0%"></div>
                            </div>
                            <div class="tnps-label">
                                <span class="tnps-emoji"><span class="circle-indicator green"></span></span>
                                <span class="tnps-name">Promotores</span>
                                <span class="tnps-value" id="promoterCount">0</span>
                            </div>
                        </div>
                        <div class="tnps-item neutral">
                            <div class="tnps-bar">
                                <div class="tnps-fill" id="neutralBar" style="width: 0%"></div>
                            </div>
                            <div class="tnps-label">
                                <span class="tnps-emoji"><span class="circle-indicator yellow"></span></span>
                                <span class="tnps-name">Neutrales</span>
                                <span class="tnps-value" id="neutralCount">0</span>
                            </div>
                        </div>
                        <div class="tnps-item detractor">
                            <div class="tnps-bar">
                                <div class="tnps-fill" id="detractorBar" style="width: 0%"></div>
                            </div>
                            <div class="tnps-label">
                                <span class="tnps-emoji"><span class="circle-indicator red"></span></span>
                                <span class="tnps-name">Detractores</span>
                                <span class="tnps-value" id="detractorCount">0</span>
                            </div>
                        </div>
                        <div class="tnps-item null">
                            <div class="tnps-bar">
                                <div class="tnps-fill" id="nullBar" style="width: 0%"></div>
                            </div>
                            <div class="tnps-label">
                                <span class="tnps-emoji"><span class="circle-indicator gray"></span></span>
                                <span class="tnps-name">Sin respuesta</span>
                                <span class="tnps-value" id="nullCount">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Distribuci√≥n por Criticidad</h3>
                </div>
                <div class="card-body">
                    <div class="criticality-chart">
                        <div class="criticality-item">
                            <div class="criticality-label">
                                <span class="badge badge-critico">Cr√≠tico</span>
                                <span id="criticalityCritical">0</span>
                            </div>
                            <div class="criticality-bar">
                                <div class="criticality-fill critical" id="criticalityCriticalBar"></div>
                            </div>
                        </div>
                        <div class="criticality-item">
                            <div class="criticality-label">
                                <span class="badge badge-alto">Alto</span>
                                <span id="criticalityHigh">0</span>
                            </div>
                            <div class="criticality-bar">
                                <div class="criticality-fill high" id="criticalityHighBar"></div>
                            </div>
                        </div>
                        <div class="criticality-item">
                            <div class="criticality-label">
                                <span class="badge badge-medio">Medio</span>
                                <span id="criticalityMedium">0</span>
                            </div>
                            <div class="criticality-bar">
                                <div class="criticality-fill medium" id="criticalityMediumBar"></div>
                            </div>
                        </div>
                        <div class="criticality-item">
                            <div class="criticality-label">
                                <span class="badge badge-perfecto">Perfecto</span>
                                <span id="criticalityPerfect">0</span>
                            </div>
                            <div class="criticality-bar">
                                <div class="criticality-fill perfect" id="criticalityPerfectBar"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top agentes -->
        <div class="card">
            <div class="card-header">
                <h3>Ranking de Agentes por Desempe√±o</h3>
                <button onclick="exportToCSV()" class="btn btn-secondary">Exportar CSV</button>
            </div>
            <div class="card-body">
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Agente</th>
                                <th>Llamadas Auditadas</th>
                                <th>Errores</th>
                                <th>Tasa de Error</th>
                                <th>TNPS Promedio</th>
                                <th>√öltimos Feedbacks</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="agentsTableBody">
                            <tr>
                                <td colspan="8" class="no-data">No hay datos disponibles. Comienza registrando auditor√≠as.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Llamadas recientes -->
        <div class="card">
            <div class="card-header">
                <h3>Auditor√≠as Recientes</h3>
                <a href="registrar-llamada.html" class="btn btn-primary">+ Nueva Auditor√≠a</a>
            </div>
            <div class="card-body">
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Customer ID</th>
                                <th>Agente</th>
                                <th>Auditor</th>
                                <th>Motivo</th>
                                <th>BPO</th>
                                <th>Criticidad</th>
                                <th>Error</th>
                                <th>TNPS</th>
                                <th>Enlace PV</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="recentCallsTableBody">
                            <tr>
                                <td colspan="11" class="no-data">No hay auditor√≠as registradas</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Feedbacks recientes -->
        <div class="card">
            <div class="card-header">
                <h3>Feedbacks Recientes</h3>
                <a href="registrar-feedback.html" class="btn btn-primary">+ Nuevo Feedback</a>
            </div>
            <div class="card-body">
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Agente</th>
                                <th>Dado Por</th>
                                <th>Tipo</th>
                                <th>Proceso</th>
                                <th>Additional Steps</th>
                                <th>Prioridad</th>
                                <th>Mensaje</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="recentFeedbacksTableBody">
                            <tr>
                                <td colspan="9" class="no-data">No hay feedbacks registrados</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Supabase SDK v2 -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    <script src="supabase-config.js"></script>
    <script src="app.js"></script>
    <script src="dashboard.js"></script>
</body>
</html>

